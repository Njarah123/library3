<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Historique des Emprunts - Biblioth√©caire</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <link rel="stylesheet" th:href="@{/css/dashboards.css}" />
    <link rel="stylesheet" href="/fontawesome/all.min.css">
    <link rel="stylesheet" href="/fonts/poppins.css">
    <script src="/js/libs/qrcode.min.js"></script>
    <script th:src="@{/js/notification-panel-ultra.js}"></script>
    <link rel="stylesheet" th:href="@{/css/notification-panel-ultra.css}">
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <a href="/librarian/dashboard" class="logo">
                <img src="/images/Logobnk.png" alt="Logobnk" />
            </a>
            <button class="sidebar-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
        </div>
               
        <div class="sidebar-menu">
            <div class="menu-section">
                <h3>Principal</h3>
                <a href="/librarian/dashboard" class="menu-item">
                    <i class="fas fa-home"></i>
                    <span>Tableau de bord</span>
                </a>
                <a href="/librarian/books" class="menu-item">
                    <i class="fas fa-book"></i>
                    <span>Livres</span>
                </a>
                <a href="/librarian/members" class="menu-item">
                    <i class="fas fa-users"></i>
                    <span>Membres</span>
                </a>
                <a href="/librarian/borrows-books" class="menu-item active">
                    <i class="fas fa-exchange-alt"></i>
                    <span>Emprunts</span>
                </a>
            </div>
                       
            <div class="menu-section">
                <h3>Gestion</h3>
                <a href="/librarian/books/add" class="menu-item">
                    <i class="fas fa-plus-circle"></i>
                    <span>Ajouter livre</span>
                </a>
                <a href="/librarian/books/update-total-borrows" class="menu-item">
                    <i class="fas fa-sync-alt"></i>
                    <span>Mettre √† jour emprunts</span>
                </a>
                <a href="/librarian/reports" class="menu-item">
                    <i class="fas fa-chart-bar"></i>
                    <span>Rapports</span>
                </a>
                <a href="/librarian/settings" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Param√®tres</span>
                </a>
            </div>
        </div>
               
        <div class="sidebar-footer">
            <div class="user-profile">
                <img th:src="${user != null && user.profileImagePath != null && !user.profileImagePath.isEmpty()} ? ${user.profileImagePath} : '/images/default-librarian.png'"
                     class="profile-avatar"
                     alt="Photo de profil">
                <div class="user-info">
                    <div class="user-name" th:text="${#authentication.name}">Nom utilisateur</div>
                    <div class="user-role">Biblioth√©caire</div>
                </div>
            </div>
            <form th:action="@{/logout}" method="post" class="logout-form">
                <button type="submit" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </form>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Header -->
        <div class="top-header">
            <div class="header-left">
                <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <h1>Historique des Emprunts</h1>
            </div>
                       
            <div class="header-right">
                <div class="search-container">
                    <!-- Search functionality can be added here if needed -->
                </div>
                               
                <div class="header-actions">
                    <button class="action-btn notification-btn" id="notificationButton">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" th:if="${unreadNotifications > 0}" th:text="${unreadNotifications}"></span>
                    </button>
                    
                    <!-- User Info Button -->
                    <div class="user-info" id="userInfoButton">
                        <img th:src="${user != null && user.profileImagePath != null && !user.profileImagePath.isEmpty()} ? ${user.profileImagePath} : '/images/default-librarian.png'"
                             alt="Photo de profil"
                             class="user-avatar">
                        <span th:text="${#authentication.name}">Nom utilisateur</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Panel Ultra -->
        <div th:replace="~{fragments/notification-panel-ultra :: notification-panel-ultra}"></div>

        <!-- Welcome Section -->
        <div class="welcome-section">
            <div class="welcome-content">
                <h2>Gestion des Emprunts üìö</h2>
                <p>Suivez et g√©rez tous les emprunts de votre biblioth√®que</p>
            </div>
            <div class="date-display">
                <div class="current-date" id="currentDate"></div>
                <div class="current-time" id="currentTime"></div>
            </div>
        </div>

        <!-- Error Alert -->
        <div th:if="${error}" class="alert alert-error" style="position: relative; margin: 0 2rem 2rem; top: 0;">
            <i class="fas fa-exclamation-triangle"></i>
            <span th:text="${error}"></span>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card primary">
                <div class="stat-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                    <h3>Total des emprunts</h3>
                    <div class="stat-number" th:text="${totalBorrowings ?: 0}">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-chart-line"></i>
                        <span>Tous les emprunts</span>
                    </div>
                </div>
            </div>
                       
            <div class="stat-card info">
                <div class="stat-icon">
                    <i class="fas fa-book-reader"></i>
                </div>
                <div class="stat-info">
                    <h3>Emprunts en cours</h3>
                    <div class="stat-number" th:text="${currentBorrowings ?: 0}">0</div>
                    <div class="stat-change neutral">
                        <i class="fas fa-clock"></i>
                        <span>En circulation</span>
                    </div>
                </div>
            </div>
                       
            <div class="stat-card warning">
                <div class="stat-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="stat-info">
                    <h3>Emprunts en retard</h3>
                    <div class="stat-number" th:text="${overdueBorrowings ?: 0}">0</div>
                    <div class="stat-change" th:class="${overdueBorrowings != null && overdueBorrowings > 0} ? 'negative' : 'positive'">
                        <i th:class="${overdueBorrowings != null && overdueBorrowings > 0} ? 'fas fa-exclamation' : 'fas fa-check'"></i>
                        <span th:text="${overdueBorrowings != null && overdueBorrowings > 0} ? 'Attention requise' : 'Parfait'">Parfait</span>
                    </div>
                </div>
            </div>

            <div class="stat-card success">
                <div class="stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <h3>Retours effectu√©s</h3>
                    <div class="stat-number" th:text="${(totalBorrowings ?: 0) - (currentBorrowings ?: 0)}">0</div>
                    <div class="stat-change positive">
                        <i class="fas fa-undo"></i>
                        <span>Livres retourn√©s</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Borrowings Table -->
        <div class="dashboard-grid" style="grid-template-columns: 1fr;">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3><i class="fas fa-list"></i> Liste des Emprunts</h3>
                    <div class="card-actions">
                        <button class="btn-icon" onclick="refreshTable()">
                            <i class="fas fa-refresh"></i>
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <div th:if="${borrowings != null and !borrowings.empty}" class="table-container">
                        <table class="borrowings-table">
                            <thead>
                                <tr>
                                    <th><i class="fas fa-book"></i> Livre</th>
                                    <th><i class="fas fa-user"></i> Emprunteur</th>
                                    <th><i class="fas fa-calendar-plus"></i> Date d'emprunt</th>
                                    <th><i class="fas fa-calendar-check"></i> Date pr√©vue</th>
                                    <th><i class="fas fa-calendar-times"></i> Date de retour</th>
                                    <th><i class="fas fa-info-circle"></i> Statut</th>
                                    <th><i class="fas fa-cogs"></i> Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="borrowing : ${borrowings}" th:data-borrowing-id="${borrowing.id}" class="borrowing-row">
                                    <td class="book-info">
                                        <div class="book-details">
                                            <div class="book-title" th:text="${borrowing.book != null ? borrowing.book.title : 'N/A'}">
                                                Titre du livre
                                            </div>
                                            <div class="book-author" th:text="${borrowing.book != null ? borrowing.book.author : 'N/A'}">
                                                Auteur
                                            </div>
                                        </div>
                                    </td>
                                    <td class="borrower-info">
                                        <div class="user-details">
                                            <div class="user-name">
                                                <i class="fas fa-user"></i>
                                                <span th:text="${borrowing.user != null ? borrowing.user.username : 'N/A'}">
                                                    Utilisateur
                                                </span>
                                            </div>
                                            <div class="user-type" th:text="${borrowing.user != null ? borrowing.user.userType : 'N/A'}">
                                                Type
                                            </div>
                                        </div>
                                    </td>
                                    <td class="date-cell">
                                        <i class="fas fa-calendar"></i>
                                        <span th:text="${borrowing.borrowDate != null ? #temporals.format(borrowing.borrowDate, 'dd/MM/yyyy HH:mm') : 'N/A'}">
                                            Date d'emprunt
                                        </span>
                                    </td>
                                    <td class="date-cell">
                                        <i class="fas fa-calendar-check"></i>
                                        <span th:text="${borrowing.dueDate != null ? #temporals.format(borrowing.dueDate, 'dd/MM/yyyy HH:mm') : 'N/A'}">
                                            Date pr√©vue
                                        </span>
                                    </td>
                                    <td class="date-cell">
                                        <i class="fas fa-calendar-times"></i>
                                        <span th:text="${borrowing.returnDate != null ? #temporals.format(borrowing.returnDate, 'dd/MM/yyyy HH:mm') : '-'}">
                                            Date de retour
                                        </span>
                                    </td>
                                    <td class="status-cell">
                                        <div th:switch="${borrowing.status}">
                                            <span th:case="${T(com.library.enums.BorrowingStatus).EMPRUNTE}" class="status-badge status-emprunte">
                                                <i class="fas fa-clock"></i> En cours
                                            </span>
                                            <span th:case="${T(com.library.enums.BorrowingStatus).RETOURNE}" class="status-badge status-retourne">
                                                <i class="fas fa-check-circle"></i> Retourn√©
                                            </span>
                                            <span th:case="${T(com.library.enums.BorrowingStatus).EN_RETARD}" class="status-badge status-retard">
                                                <i class="fas fa-exclamation-triangle"></i> En retard
                                            </span>
                                            <span th:case="${T(com.library.enums.BorrowingStatus).EN_ATTENTE}" class="status-badge status-attente">
                                                <i class="fas fa-hourglass-half"></i> En attente
                                            </span>
                                            <span th:case="${T(com.library.enums.BorrowingStatus).PERDU}" class="status-badge status-perdu">
                                                <i class="fas fa-times-circle"></i> Perdu
                                            </span>
                                            <span th:case="*" class="status-badge status-na">
                                                <i class="fas fa-question"></i> N/A
                                            </span>
                                        </div>
                                    </td>
                                    <td class="actions-cell">
                                        <th:block th:if="${borrowing.status != null}">
                                            <button th:if="${borrowing.status.name() == 'EMPRUNTE'}"
                                                    class="btn btn-success btn-sm"
                                                    th:onclick="'returnBook(' + ${borrowing.id} + ')'"
                                                    title="Marquer comme retourn√©">
                                                <i class="fas fa-check"></i>
                                                Retourner
                                            </button>
                                        </th:block>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- No borrowings message -->
                    <div th:if="${borrowings == null or borrowings.empty}" class="no-data">
                        <i class="fas fa-info-circle"></i>
                        <p>Aucun emprunt trouv√©</p>
                        <small>Les emprunts appara√Ætront ici une fois qu'ils seront effectu√©s</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Dropdown -->
    <div class="profile-dropdown" id="profileDropdown">
        <div class="profile-header">
            <img th:src="${user != null && user.profileImagePath != null && !user.profileImagePath.isEmpty()} ? ${user.profileImagePath} : '/images/default-librarian.png'"
                 alt="Photo de profil"
                 class="profile-avatar">
            <div class="profile-name" th:text="${#authentication.name}">Nom utilisateur</div>
            <div class="profile-role">Biblioth√©caire</div>
        </div>
        
        <div class="profile-info">
            <div class="info-item">
                <i class="fas fa-envelope"></i>
                <span>email@example.com</span>
            </div>
            <div class="info-item">
                <i class="fas fa-id-card"></i>
                <span>ID: 12345</span>
            </div>
            <div class="info-item">
                <i class="fas fa-user"></i>
                <span th:text="${#authentication.name}">username</span>
            </div>
            <div class="info-item">
                <i class="fas fa-user-tag"></i>
                <span>LIBRARIAN</span>
            </div>
        </div>
        
        <!-- QR Code Section -->
        <div class="qr-code-section">
            <div class="qr-header">
                <i class="fas fa-qrcode"></i>
                <span>Code QR Utilisateur</span>
            </div>
            <div class="qr-container" id="userQRCode"></div>
            <div class="qr-info">
                <small>Scannez pour acc√©der aux informations utilisateur</small>
            </div>
        </div>
        
        <div class="profile-actions">
            <a href="/librarian/settings" class="profile-action-btn">
                <i class="fas fa-cog"></i>
                Param√®tres
            </a>
            <form th:action="@{/logout}" method="post" style="margin: 0;">
                <button type="submit" class="profile-action-btn logout" style="width: 100%; text-align: left;">
                    <i class="fas fa-sign-out-alt"></i>
                    D√©connexion
                </button>
            </form>
        </div>
    </div>

    <!-- Overlays -->
    <div class="profile-overlay" id="profileOverlay"></div>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- JavaScript -->
    <script th:inline="javascript">
        // Variables globales
        let qrGenerated = false;

        // FONCTION QR CODE
        function generateUserQRCode() {
            if (qrGenerated) return;
            
            const qrContainer = document.getElementById('userQRCode');
            if (!qrContainer) return;
            
            // Clear any existing QR code
            qrContainer.innerHTML = '';
            
            // Get user data from Thymeleaf
            const userData = {
                id: '12345',
                name: /*[[${#authentication.name}]]*/ 'Nom utilisateur',
                email: 'email@example.com',
                username: /*[[${#authentication.name}]]*/ 'username',
                userType: 'LIBRARIAN',
                timestamp: new Date().toISOString()
            };
            
            // Create QR code data
            const qrData = JSON.stringify(userData);
            
            try {
                // Check if QRCode is available
                if (typeof QRCode === 'undefined') {
                    console.error('QRCode library not loaded');
                    qrContainer.innerHTML = '<div class="qr-error"><i class="fas fa-exclamation-triangle"></i><br>QR indisponible</div>';
                    return;
                }
                
                // Create a div element for QR code
                const qrDiv = document.createElement('div');
                qrDiv.style.display = 'inline-block';
                qrDiv.style.borderRadius = '8px';
                qrDiv.style.border = '2px solid #e5e7eb';
                qrDiv.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                qrDiv.style.overflow = 'hidden';
                
                // Generate QR code using the correct constructor
                const qrcode = new QRCode(qrDiv, {
                    text: qrData,
                    width: 120,
                    height: 120,
                    colorDark: '#1f2937',
                    colorLight: '#ffffff',
                    correctLevel: QRCode.CorrectLevel.M
                });
                
                qrContainer.appendChild(qrDiv);
                qrGenerated = true;
                
            } catch (error) {
                console.error('Erreur QR code:', error);
                qrContainer.innerHTML = '<div class="qr-error"><i class="fas fa-exclamation-triangle"></i><br>QR indisponible</div>';
            }
        }

        // FONCTIONS DROPDOWN
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            const overlay = document.getElementById('profileOverlay');
            
            if (dropdown.classList.contains('show')) {
                dropdown.classList.remove('show');
                overlay.classList.remove('show');
            } else {
                dropdown.classList.add('show');
                overlay.classList.add('show');
                // Generate QR code when dropdown opens
                setTimeout(generateUserQRCode, 100);
            }
        }

        function closeProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            const overlay = document.getElementById('profileOverlay');
            dropdown.classList.remove('show');
            overlay.classList.remove('show');
        }

        // SIDEBAR FUNCTIONS
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar && mainContent && overlay) {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
                overlay.classList.toggle('active');
            }
        }

        // DATE TIME FUNCTIONS
        function updateDateTime() {
            const now = new Date();
            
            const dateElement = document.getElementById('currentDate');
            const timeElement = document.getElementById('currentTime');
            
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
            
            if (timeElement) {
                timeElement.textContent = now.toLocaleTimeString('fr-FR', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }

        // BORROWING FUNCTIONS
        function returnBook(id) {
            if (confirm('Confirmer le retour de ce livre ?')) {
                showNotification('Traitement du retour en cours...', 'info');
                
                fetch(`/librarian/borrowings/${id}/return`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        showNotification('Livre retourn√© avec succ√®s!', 'success');
                        setTimeout(() => {
                            location.reload();
                        }, 1500);
                    } else {
                        throw new Error('Erreur lors du retour du livre');
                    }
                })
                .catch(error => {
                    console.error('Erreur:', error);
                    showNotification('Erreur lors du retour du livre', 'error');
                });
            }
        }

        function refreshTable() {
            showNotification('Actualisation en cours...', 'info');
            setTimeout(() => {
                location.reload();
            }, 1000);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type}`;
            
            let borderColor, textColor, iconClass;
            switch(type) {
                case 'success':
                    borderColor = '#10b981';
                    textColor = '#10b981';
                    iconClass = 'fa-check-circle';
                    break;
                case 'error':
                    borderColor = '#ef4444';
                    textColor = '#ef4444';
                    iconClass = 'fa-exclamation-triangle';
                    break;
                default:
                    borderColor = '#3b82f6';
                    textColor = '#3b82f6';
                    iconClass = 'fa-info-circle';
            }
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                max-width: 350px;
                padding: 1rem 1.5rem;
                border-radius: 12px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.15);
                background: white;
                border-left: 4px solid ${borderColor};
                color: ${textColor};
                font-weight: 500;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                animation: slideDown 0.3s ease-out;
            `;
            
            notification.innerHTML = `
                <i class="fas ${iconClass}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease-out forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // EVENT LISTENERS
        document.addEventListener('DOMContentLoaded', function() {
            // Mettre √† jour la date/heure
            updateDateTime();
            setInterval(updateDateTime, 60000);

            // Gestion du dropdown
            const userInfoBtn = document.getElementById('userInfoButton');
            const overlay = document.getElementById('profileOverlay');
            
            if (userInfoBtn) {
                userInfoBtn.addEventListener('click', toggleProfileDropdown);
            }
            
            if (overlay) {
                overlay.addEventListener('click', closeProfileDropdown);
            }
            
            // Initialize notification panel ultra
            if (typeof NotificationPanelUltra !== 'undefined') {
                const notificationPanel = new NotificationPanelUltra('notificationButton');
                console.log('NotificationPanelUltra initialized for borrows page');
            } else {
                console.error('NotificationPanelUltra class not found');
            }

            // Fermer avec la touche √âchap
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    closeProfileDropdown();
                }
            });
        });

        // PROFILE IMAGE LOADING
        function ensureProfileImagesLoad() {
            const profileImages = document.querySelectorAll('.profile-avatar, .user-avatar');
            
            profileImages.forEach(img => {
                // Handle image load error - fallback to default image
                img.onerror = function() {
                    console.log('Profile image failed to load, using default fallback');
                    this.src = '/images/default-librarian.png';
                };
            });
        }

        // Call profile image function
        ensureProfileImagesLoad();

        // Fermer sidebar en cliquant sur l'overlay
        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            toggleSidebar();
        });

        console.log('Borrows page initialized');
    </script>

    <style>
        /* Additional styles for borrows page */
        
        /* QR Code Styles */
        .qr-code-section {
            margin-top: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }

        .qr-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--gray-700);
        }

        .qr-header i {
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .qr-container {
            display: flex;
            justify-content: center;
            margin-bottom: 0.5rem;
        }

        .qr-info {
            color: var(--gray-500);
            font-size: 0.75rem;
        }

        .qr-error {
            padding: 1rem;
            color: var(--gray-400);
            font-size: 0.75rem;
            text-align: center;
        }

        .qr-error i {
            display: block;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* Enhanced Table Styles */
        .table-container {
            overflow-x: auto;
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--gray-200);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            background: var(--white);
        }

        .borrowings-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
            font-size: 0.875rem;
        }

        .borrowings-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            padding: 1.25rem 1rem;
            text-align: left;
            font-weight: 700;
            color: var(--gray-800);
            border-bottom: 3px solid var(--primary-color);
            white-space: nowrap;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .borrowings-table th i {
            margin-right: 0.75rem;
            color: var(--primary-color);
            font-size: 1rem;
        }

        .borrowings-table td {
            padding: 1.25rem 1rem;
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
            transition: all 0.2s ease;
        }

        .borrowing-row {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .borrowing-row:hover {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--primary-color);
            transform: translateX(2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .borrowing-row:nth-child(even) {
            background: rgba(248, 250, 252, 0.5);
        }

        .borrowing-row:nth-child(even):hover {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        .book-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, #fefefe 0%, #f8fafc 100%);
            border-radius: 8px;
            border-left: 3px solid var(--primary-color);
        }

        .book-title {
            font-weight: 700;
            color: var(--gray-900);
            line-height: 1.4;
            font-size: 0.95rem;
        }

        .book-author {
            font-size: 0.8rem;
            color: var(--gray-600);
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .book-author::before {
            content: "‚úçÔ∏è";
            font-size: 0.75rem;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.5rem;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 8px;
            border-left: 3px solid var(--info-color);
        }

        .user-name {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.9rem;
        }

        .user-name i {
            color: var(--primary-color);
            background: var(--white);
            padding: 0.25rem;
            border-radius: 50%;
            font-size: 0.75rem;
        }

        .user-type {
            font-size: 0.75rem;
            color: var(--info-color);
            text-transform: uppercase;
            font-weight: 600;
            background: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
            width: fit-content;
        }

        .date-cell {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: var(--gray-700);
            white-space: nowrap;
            padding: 0.5rem;
            background: linear-gradient(135deg, #fefefe 0%, #f1f5f9 100%);
            border-radius: 8px;
            border-left: 3px solid var(--info-color);
            font-weight: 500;
        }

        .date-cell i {
            color: var(--info-color);
            background: var(--white);
            padding: 0.375rem;
            border-radius: 50%;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .date-cell span {
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            border: 2px solid;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .status-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .status-emprunte {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            color: var(--info-color);
            border-color: var(--info-color);
        }

        .status-retourne {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: var(--success-color);
            border-color: var(--success-color);
        }

        .status-retard {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: var(--danger-color);
            border-color: var(--danger-color);
            animation: pulse 2s infinite;
        }

        .status-attente {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: var(--warning-color);
            border-color: var(--warning-color);
        }

        .status-perdu {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            color: var(--gray-600);
            border-color: var(--gray-600);
        }

        .status-na {
            background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
            color: var(--gray-500);
            border-color: var(--gray-400);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            border: 2px solid;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 700;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color) 0%, #0da271 100%);
            color: var(--white);
            border-color: var(--success-color);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #0da271 0%, #059669 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }

        .btn-success:active {
            transform: translateY(0);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .btn i {
            font-size: 1rem;
        }

        .no-data {
            text-align: center;
            padding: 3rem 2rem;
            color: var(--gray-500);
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-data p {
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .no-data small {
            color: var(--gray-400);
        }

        .alert {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius-lg);
            font-weight: 500;
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-left: 4px solid var(--danger-color);
        }

        /* Animations for notifications */
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .table-container {
                font-size: 0.75rem;
            }
            
            .borrowings-table th,
            .borrowings-table td {
                padding: 0.75rem 0.5rem;
            }
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .borrowings-table {
                font-size: 0.75rem;
            }
            
            .borrowings-table th,
            .borrowings-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .book-title,
            .user-name {
                font-size: 0.875rem;
            }
            
            .date-cell {
                flex-direction: column;
                gap: 0.25rem;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .table-container {
                overflow-x: scroll;
            }
            
            .borrowings-table {
                min-width: 800px;
            }
        }
    </style>
</body>
</html>
